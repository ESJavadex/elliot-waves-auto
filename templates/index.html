<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliott Wave Analysis & Trade Ideas (2025-04-21)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* Base Variables */
        :root {
            --bg-primary: #1a1d24;
            --bg-secondary: #252a33;
            --bg-tertiary: #2d3340;
            --bg-input: #343c4a;
            --text-primary: #e4e6eb;
            --text-secondary: #b0b3b8;
            --text-muted: #8a8d91;
            --accent-primary: #4d84ff;
            --accent-secondary: #3a6bc5;
            --accent-tertiary: #2e4e8f;
            --success: #4ade80;
            --warning: #facc15;
            --danger: #f87171;
            --border-color: #3e4756;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.25);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.2), 0 3px 6px rgba(0,0,0,0.25);
            --shadow-lg: 0 10px 20px rgba(0,0,0,0.25), 0 6px 10px rgba(0,0,0,0.25);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --transition-fast: all 0.2s ease;
            --transition-normal: all 0.3s ease;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        /* Base Styles */
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: var(--font-family); background-color: var(--bg-primary); color: var(--text-primary); line-height: 1.6; margin: 0; padding: 0; min-height: 100vh; }
        .container { background-color: var(--bg-secondary); padding: 40px; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); max-width: 1500px; margin: 30px auto; border: 1px solid var(--border-color); }

        /* Titles */
        h1, h2, h3 { text-align: center; color: var(--accent-primary); margin-bottom: 30px; font-weight: 600; letter-spacing: -0.02em; }
        h1 { font-size: 2.4em; margin-top: 0; background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-tertiary) 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; position: relative; display: inline-block; left: 50%; transform: translateX(-50%); padding-bottom: 15px; }
        h1::after { content: ''; position: absolute; bottom: 0; left: 10%; right: 10%; height: 3px; background: linear-gradient(90deg, transparent, var(--accent-primary), transparent); border-radius: 3px; }
        h2 { font-size: 1.8em; margin-top: 50px; position: relative; padding-bottom: 15px; }
        h2::after { content: ''; position: absolute; bottom: 0; left: 30%; right: 30%; height: 2px; background: linear-gradient(90deg, transparent, var(--accent-secondary), transparent); border-radius: 2px; }
        h3 { font-size: 1.4em; color: var(--accent-secondary); margin-bottom: 25px; }

        /* Form General */
        form { display: flex; flex-direction: column; gap: 25px; /* Reduced gap between main box and submit */ margin-bottom: 50px; }

        /* THE MAIN CONDENSED SETTINGS BOX */
        .main-settings-box {
            display: grid;
            /* Adjust columns based on screen size */
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px 25px; /* Row gap, Column gap */
            padding: 30px;
            background-color: var(--bg-tertiary); /* Background for the main box */
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
            position: relative; /* For pseudo-element */
            overflow: hidden;
        }
        .main-settings-box::before { /* Top accent line */
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
            background: linear-gradient(90deg, var(--accent-tertiary), var(--accent-primary), var(--accent-tertiary));
            z-index: 1;
        }

        /* Grid Item Styling */
        .grid-item {
            min-width: 0; /* Prevent grid blowout */
            display: flex;
            flex-direction: column;
            gap: 8px; /* Space between label and input */
        }
        /* Span full width */
        .grid-item-full { grid-column: 1 / -1; }

        /* Input Group within Grid */
        .input-group {
            display: flex;
            flex-direction: column;
            width: 100%; /* Take full width of grid cell */
        }

        /* Labels within Grid */
        label {
            margin-bottom: 4px; /* Reduced space */
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9em; /* Smaller labels */
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: flex-start; /* Align left */
        }

        /* Inputs within Grid */
        input[type="text"], input[type="date"], select, input[type="number"] {
            padding: 10px 12px; /* Reduced padding */
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background-color: var(--bg-input);
            color: var(--text-primary);
            font-size: 0.95em; /* Slightly smaller font */
            width: 100%;
            transition: var(--transition-fast);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            outline: none;
        }
        input:focus, select:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(77, 132, 255, 0.25), inset 0 1px 2px rgba(0,0,0,0.1);
        }
        input::placeholder { color: var(--text-muted); }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(0.8) brightness(1.1); cursor: pointer; transition: var(--transition-fast); }
        input[type="date"]::-webkit-calendar-picker-indicator:hover { filter: invert(1) brightness(1); }
        select { cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg fill="%23e4e6eb" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); background-repeat: no-repeat; background-position: right 10px center; background-size: 1.1em; padding-right: 35px; }

        /* Helper Text */
        small {
            font-size: 0.8em; /* Smaller helper text */
            color: var(--text-muted);
            display: block;
            margin-top: 3px;
            text-align: left;
        }

        /* Section Subheadings within Grid Box */
        .section-subheading {
            grid-column: 1 / -1; /* Span all columns */
            text-align: center;
            font-size: 1.1em;
            color: var(--text-secondary);
            font-weight: 500;
            margin-top: 15px; /* Space above subheading */
            margin-bottom: 0px; /* Reduced space below */
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        /* Ticker/List specifics */
        #multi-stock-inputs { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .quick-presets { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; width: 100%; margin-top: 5px; }
        .quick-presets-label { display: none; /* Hide label, assumed context */ }
        .preset-btn { padding: 6px 12px; font-size: 0.85em; } /* Smaller buttons */

        /* Toggle Switch Styling (used for checkboxes) */
        .form-toggle { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; /* Allow centering */ }
        .toggle-switch { position: relative; display: inline-flex; align-items: center; cursor: pointer; user-select: none; vertical-align: middle; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; position: absolute; }
        .toggle-slider { position: relative; display: inline-block; width: 40px; height: 22px; background-color: var(--bg-input); border-radius: 22px; transition: var(--transition-normal); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); border: 1px solid var(--border-color); }
        .toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: var(--text-secondary); border-radius: 50%; transition: var(--transition-normal); box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        input:checked + .toggle-slider { background-color: var(--accent-primary); border-color: var(--accent-secondary); }
        input:checked + .toggle-slider:before { transform: translateX(18px); background-color: white; }
        .toggle-label { color: var(--text-secondary); font-size: 0.9em; font-weight: 500; cursor: pointer; transition: color var(--transition-fast); text-align: right; /* Align label to right of switch */ flex-grow: 1; }
        .form-toggle .toggle-label { text-align: center; flex-grow: 0;} /* Center labels for toggles used alone */
        .toggle-label:hover { color: var(--text-primary); }
        /* Adjust toggle position for specific items */
        .backtest-toggle-item, .plot-toggle-item { justify-content: center; }


        /* Backtest Info Box */
        .backtest-info { text-align: center; font-size: 0.85em; color: var(--warning); margin-top: 10px; background-color: rgba(250, 204, 21, 0.08); padding: 10px; border-radius: var(--radius-sm); border: 1px solid rgba(250, 204, 21, 0.2); line-height: 1.4; width: 100%; grid-column: 1 / -1; /* Span columns */ }


        /* Submit Section */
        .submit-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px; /* Space between plot toggle and button */
            margin-top: 10px; /* Space above submit area */
        }
        input[type="submit"] { padding: 12px 35px; font-size: 1.0em; } /* Slightly smaller button */

        /* Responsiveness */
        @media (max-width: 900px) {
            .main-settings-box {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Adjust minmax */
                gap: 15px 20px; /* Reduce gap */
            }
        }
        @media (max-width: 600px) {
            .main-settings-box {
                grid-template-columns: 1fr; /* Stack into 1 column */
                gap: 15px;
            }
             .section-subheading { margin-top: 20px; }
             .container { padding: 20px; }
             form { padding: 20px; }
        }


        /* --- Results Area Styling --- */
        /* (Keeping these styles largely the same as before for brevity) */
        .plot-container { margin-top: 40px; border: 1px solid var(--border-color); border-radius: var(--radius-md); background-color: rgba(0, 0, 0, 0.2); padding: 15px; overflow-x: auto; box-shadow: var(--shadow-md); transition: var(--transition-normal); position: relative; }
        .plot-container::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, transparent, var(--accent-primary), transparent); border-radius: 3px 3px 0 0; }
        .plot-container:hover { box-shadow: var(--shadow-lg); transform: translateY(-2px); }
        .plot-container .plotly-graph-div { width: 100% !important; }
        .error { color: var(--danger); text-align: center; font-weight: 600; margin: 30px 0; padding: 18px; background-color: rgba(248, 113, 113, 0.1); border: 1px solid var(--danger); border-radius: var(--radius-md); box-shadow: var(--shadow-sm); position: relative; }
        .error::before { content: '⚠️'; display: inline-block; margin-right: 10px; font-size: 1.2em; }
        .disclaimer { margin-top: 60px; padding: 25px; border: 1px solid var(--warning); background-color: rgba(250, 204, 21, 0.05); color: var(--warning); border-radius: var(--radius-md); text-align: center; font-size: 0.95em; line-height: 1.6; box-shadow: var(--shadow-sm); position: relative; }
        .disclaimer::before { content: ''; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); width: 70%; height: 2px; background: linear-gradient(90deg, transparent, var(--warning), transparent); }
        .disclaimer strong { font-weight: 700; color: var(--warning); display: block; margin-bottom: 10px; font-size: 1.1em; }
        pre { background-color: var(--bg-primary); padding: 20px; border-radius: var(--radius-md); border: 1px solid var(--border-color); white-space: pre-wrap; word-wrap: break-word; color: var(--text-secondary); font-size: 0.9em; max-height: 450px; overflow-y: auto; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); font-family: 'Fira Code', 'Consolas', monospace; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; margin-top: 40px; }
        .summary-section { background-color: var(--bg-tertiary); padding: 25px 30px; border-radius: var(--radius-md); border: 1px solid var(--border-color); box-shadow: var(--shadow-md); transition: var(--transition-normal); position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .summary-section::before { content: ''; position: absolute; top: 0; left: 0; width: 5px; height: 100%; background: linear-gradient(to bottom, var(--accent-primary), var(--accent-tertiary)); }
        .summary-section:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        .summary-section h3 { color: var(--success); margin-top: 0; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color); font-size: 1.25em; position: relative; text-align: left; width: 100%; }
        .summary-section h3::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 60px; height: 3px; background-color: var(--success); border-radius: 3px; }
        .summary-section.correction-guess h3 { color: #ff69b4; }
        .summary-section.correction-guess h3::after { background-color: #ff69b4; }
        .summary-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
        .summary-list li { margin-bottom: 12px; color: var(--text-secondary); font-size: 0.95em; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; padding-bottom: 10px; border-bottom: 1px dotted var(--border-color); transition: var(--transition-fast); line-height: 1.4; }
        .summary-list li:hover { background-color: rgba(255, 255, 255, 0.02); transform: translateX(4px); border-bottom-color: var(--accent-primary); }
        .summary-list li:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .summary-list .value, .summary-list span[class^="value-"] { font-weight: 600; color: var(--accent-primary); margin-left: 10px; text-align: right; flex-shrink: 0; }
        .summary-list .value-true { color: var(--success); position: relative; }
        .summary-list .value-true::before { content: '✓'; margin-right: 4px; font-size: 0.9em; font-weight: bold; }
        .summary-list .value-false { color: var(--danger); position: relative; }
        .summary-list .value-false::before { content: '✗'; margin-right: 4px; font-size: 0.9em; font-weight: bold; }
        .summary-list.checks li { font-size: 0.9em; }
        .summary-list.fibs .value { color: #c678dd; }
        .summary-list.fibs span.value + span { color: #abb2bf; font-weight: normal; font-size: 0.9em; margin-left: 5px; }
        details { margin-top: 25px; border: 1px solid var(--border-color); border-radius: var(--radius-md); background-color: var(--bg-secondary); box-shadow: var(--shadow-sm); transition: var(--transition-fast); overflow: hidden; }
        details:hover { box-shadow: var(--shadow-md); border-color: var(--accent-secondary); }
        summary { padding: 14px 18px; font-weight: 600; cursor: pointer; color: var(--warning); background-color: var(--bg-tertiary); outline: none; transition: var(--transition-fast); position: relative; list-style: none; display: block; }
        summary::-webkit-details-marker { display: none; }
        summary::before { content: '►'; color: var(--warning); margin-right: 12px; display: inline-block; transition: transform 0.3s ease-in-out; font-size: 0.8em; }
        details[open] summary::before { transform: rotate(90deg); }
        summary:hover { background-color: rgba(255, 255, 255, 0.05); color: var(--accent-primary); }
        summary:hover::before { color: var(--accent-primary); }
        details[open] summary { border-bottom: 1px solid var(--border-color); }
        details > *:not(summary) { padding: 20px; }
        details pre { margin-top: 0; max-height: 350px; font-size: 0.85em; }
        ul.raw-vol { font-size: 0.9em; list-style: none; padding: 0; margin: 0;}
        ul.raw-vol li { border-bottom: none; margin-bottom: 5px; }
        ul.raw-vol .value { color: #abb2bf; font-weight: normal; }
        .correction-guess { background: linear-gradient(135deg, rgba(255, 105, 180, 0.07) 0%, rgba(255, 105, 180, 0.03) 100%); border-color: rgba(255, 105, 180, 0.4); }
        .correction-guess::before { background: linear-gradient(to bottom, #ff69b4, #e05c9f); }
        .trade-recommendation-section { background-color: var(--bg-tertiary); padding: 30px 35px; border-radius: var(--radius-md); border: 1px solid var(--border-color); margin-top: 50px; box-shadow: var(--shadow-md); transition: var(--transition-normal); position: relative; overflow: hidden; }
        .trade-recommendation-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent-tertiary), var(--accent-primary), var(--accent-tertiary)); }
        .trade-recommendation-section::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at top right, rgba(77, 132, 255, 0.08), transparent 70%); pointer-events: none; opacity: 0.7; }
        .trade-recommendation-section:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        .trade-recommendation-section h3 { color: var(--accent-primary); margin-top: 0; margin-bottom: 30px; padding-bottom: 18px; border-bottom: 1px solid var(--border-color); font-size: 1.4em; text-align: center; position: relative; }
        .trade-recommendation-section h3::after { content: ''; position: absolute; bottom: -1px; left: 35%; right: 35%; height: 3px; background: var(--accent-primary); border-radius: 3px; }
        .trade-recommendation-section .trade-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 25px 35px; margin-bottom: 30px; }
        .trade-recommendation-section .trade-item { background-color: rgba(0, 0, 0, 0.2); padding: 18px 22px; border-radius: var(--radius-sm); border-left: 5px solid transparent; box-shadow: var(--shadow-sm); transition: var(--transition-fast); position: relative; }
        .trade-recommendation-section .trade-item:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); background-color: rgba(0, 0, 0, 0.25); }
        .trade-recommendation-section .trade-item label { font-weight: 500; color: var(--text-secondary); display: block; font-size: 0.88em; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.6px; }
        .trade-recommendation-section .trade-item .value { font-weight: 600; font-size: 1.2em; color: var(--text-primary); text-shadow: 0 1px 2px rgba(0,0,0,0.2); line-height: 1.3; }
        .trade-recommendation-section .signal-long { border-left-color: var(--success); background: linear-gradient(to right, rgba(74, 222, 128, 0.08), transparent 80%); }
        .trade-recommendation-section .signal-short { border-left-color: var(--danger); background: linear-gradient(to right, rgba(248, 113, 113, 0.08), transparent 80%); }
        .trade-recommendation-section .signal-long .value { color: var(--success); }
        .trade-recommendation-section .signal-short .value { color: var(--danger); }
        .trade-recommendation-section .confidence-score .value { color: var(--warning); }
        .trade-recommendation-section .risk-reward .value { color: #c678dd; }
        .trade-recommendation-section .no-trade { color: var(--text-muted); text-align: center; font-style: italic; padding: 25px; background-color: rgba(0, 0, 0, 0.15); border-radius: var(--radius-sm); border: 1px dashed var(--border-color); font-size: 1.05em; }
        .trade-recommendation-section .trade-notes { font-size: 0.95em; color: var(--text-secondary); margin-top: 25px; text-align: center; border-top: 1px dotted var(--border-color); padding-top: 20px; line-height: 1.6; }
        .trade-recommendation-section .trade-item small { color: var(--text-muted); display: block; font-size: 0.85em; margin-top: 4px; line-height: 1.3; }
        .multi-stock-results { margin: 30px 0; overflow-x: auto; transition: var(--transition-normal); border-radius: var(--radius-md); box-shadow: var(--shadow-md); opacity: 1; max-height: 1000px; }
        .multi-stock-results.collapsed { max-height: 0; overflow: hidden; opacity: 0; margin-top: 0; margin-bottom: 0; box-shadow: none; border: none; }
        .stock-results-table { width: 100%; border-collapse: separate; border-spacing: 0; background-color: var(--bg-tertiary); border-radius: var(--radius-md); overflow: hidden; box-shadow: var(--shadow-md); }
        .stock-results-table th, .stock-results-table td { padding: 16px 20px; text-align: left; border-bottom: 1px solid var(--border-color); transition: var(--transition-fast); white-space: nowrap; }
        .stock-results-table th { background-color: var(--bg-secondary); color: var(--accent-primary); font-weight: 600; text-transform: uppercase; font-size: 0.88em; letter-spacing: 0.6px; position: sticky; top: 0; z-index: 10; }
        .stock-results-table tr:last-child td { border-bottom: none; }
        .stock-results-table tr:nth-child(even) td { background-color: rgba(0,0,0,0.1); }
        .stock-results-table tr.trade-found { position: relative; }
        .stock-results-table tr.trade-found td:first-child { position: relative; font-weight: 600; }
        .stock-results-table tr.trade-found td:first-child::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background-color: var(--accent-primary); }
        .stock-results-table tr.no-trade { color: var(--text-muted); opacity: 0.8; }
        .stock-results-table tr:not(.no-trade):hover { background-color: rgba(77, 132, 255, 0.1); }
        .stock-results-table tr.no-trade:hover { background-color: rgba(255, 255, 255, 0.04); opacity: 1; }
        .show-plot-form { margin: 0; padding: 0; display: flex; justify-content: center; }
        .show-plot-btn { padding: 8px 16px; background-color: var(--accent-secondary); color: white; border: none; border-radius: var(--radius-sm); cursor: pointer; font-size: 0.85em; font-weight: 500; transition: var(--transition-fast); box-shadow: var(--shadow-sm); text-transform: uppercase; letter-spacing: 0.5px; }
        .show-plot-btn:hover { background-color: var(--accent-primary); transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .show-plot-btn:active { transform: translateY(0); box-shadow: var(--shadow-sm); background-color: var(--accent-tertiary); }
        .filter-controls { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; padding: 18px 25px; background-color: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-color); }
        .stocks-count { color: var(--text-secondary); font-size: 0.9em; background-color: rgba(0, 0, 0, 0.2); padding: 8px 14px; border-radius: var(--radius-sm); border: 1px solid var(--border-color); }
        .table-controls { display: flex; align-items: center; gap: 18px; }
        .toggle-table-btn { display: flex; align-items: center; gap: 10px; padding: 9px 18px; background-color: var(--bg-tertiary); color: var(--accent-primary); border: 1px solid var(--border-color); border-radius: var(--radius-sm); cursor: pointer; font-size: 0.9em; transition: var(--transition-fast); font-weight: 500; }
        .toggle-table-btn:hover { background-color: var(--bg-input); border-color: var(--accent-primary); transform: translateY(-1px); }
        .toggle-table-btn .icon { transition: transform 0.3s ease; font-size: 1.1em; line-height: 1; width: 1em; text-align: center; }
        .toggle-table-btn.collapsed .icon { transform: rotate(-90deg); }
        .preset-btn:hover { background-color: var(--bg-input); border-color: var(--accent-primary); color: var(--accent-primary); transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .preset-btn:active { transform: translateY(0); box-shadow: var(--shadow-sm); }
        tr.no-trade.hidden { display: none; }
        th.sortable { cursor: pointer; position: relative; user-select: none; padding-right: 30px; }
        th.sortable::after { content: ''; position: absolute; right: 10px; top: 50%; transform: translateY(calc(-50% + 2px)); border: 4px solid transparent; border-top-color: var(--text-muted); opacity: 0.5; transition: opacity var(--transition-fast), border-color var(--transition-fast); width: 0; height: 0; border-bottom-width: 0; }
        th.sortable::before { content: ''; position: absolute; right: 10px; top: 50%; transform: translateY(calc(-50% - 2px)); border: 4px solid transparent; border-bottom-color: var(--text-muted); opacity: 0.5; transition: opacity var(--transition-fast), border-color var(--transition-fast); width: 0; height: 0; border-top-width: 0; }
        th.sortable:hover::after, th.sortable:hover::before { opacity: 0.8; }
        th.sort-asc::after { opacity: 0.3; }
        th.sort-asc::before { opacity: 1; border-bottom-color: var(--accent-primary); }
        th.sort-desc::before { opacity: 0.3; }
        th.sort-desc::after { opacity: 1; border-top-color: var(--accent-primary); }
        .wave-cell { position: relative; text-align: center; }
        .wave-label { font-weight: bold; font-size: 1.1em; margin-right: 5px; color: var(--text-primary); }
        .correction-badge { display: inline-block; font-size: 0.75em; padding: 3px 6px; background-color: rgba(255, 105, 180, 0.8); color: white; border-radius: var(--radius-sm); margin-left: 5px; cursor: help; vertical-align: middle; font-weight: 500; }
        .impulse-badge { display: inline-block; font-size: 0.8em; padding: 2px 5px; background-color: rgba(77, 132, 255, 0.8); color: white; border-radius: 50%; margin-left: 5px; cursor: help; vertical-align: middle; font-weight: bold; line-height: 1; }
        footer { margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center; font-size: 0.9em; color: var(--text-muted); }
        footer a { color: var(--text-secondary); text-decoration: none; transition: color var(--transition-fast); }
        footer a:hover { color: var(--accent-primary); text-decoration: underline; }

    </style>
</head>
<body>
    <div class="container">
        <h1>Conceptual Elliott Wave Analysis & Trade Ideas</h1>

        <form method="POST">

            <div class="main-settings-box">

                <div class="grid-item grid-item-full"> <div class="input-group mode-select-group" style="margin: 0 auto;"> <label for="analysis_mode">Analysis Mode</label>
                        <select id="analysis_mode" name="analysis_mode">
                            <option value="single" {% if form_values.analysis_mode != 'multi' %}selected{% endif %}>Single Stock</option>
                            <option value="multi" {% if form_values.analysis_mode == 'multi' %}selected{% endif %}>Multiple Stocks</option>
                        </select>
                    </div>
                </div>

                <div class="grid-item" id="single-ticker-group">
                    <div class="input-group">
                        <label for="ticker">Ticker:</label>
                        <input type="text" id="ticker" name="ticker" value="{{ form_values.ticker | default('^SPX', true) }}">
                        <small>e.g., AAPL, ^SPX</small>
                    </div>
                </div>
                <div class="grid-item grid-item-full" id="multi-stock-inputs"> <div class="input-group">
                        <label for="stock_list">Stock List (comma separated):</label>
                        <input type="text" id="stock_list" name="stock_list" value="{{ form_values.stock_list }}" placeholder="MSFT,AAPL,NVDA,SPY">
                        <small>Enter multiple tickers separated by commas.</small>
                    </div>
                    <div class="quick-presets">
                        <button type="button" class="preset-btn" data-stocks="MSFT,AAPL,NVDA,GOOGL,META,AMZN,TSLA">Tech Giants</button>
                        <button type="button" class="preset-btn" data-stocks="SPY,QQQ,DIA,IWM,VTI">Major ETFs</button>
                        <button type="button" class="preset-btn" onclick="alert('Preset too large. Please paste a list manually.');">Large Cap (Manual)</button>
                        <button type="button" class="preset-btn" data-stocks="">Clear</button>
                    </div>
                </div>

                <div class="grid-item">
                    <div class="input-group">
                        <label for="start_date">Start Date:</label>
                        <input type="date" id="start_date" name="start_date" value="{{ form_values.start_date | default(default_start_date, true) }}" required>
                    </div>
                 </div>
                 <div class="grid-item">
                    <div class="input-group">
                        <label for="end_date">End Date (Standard):</label>
                        <input type="date" id="end_date" name="end_date" value="{{ form_values.end_date | default(default_end_date, true) }}">
                        <small>Leave blank for today.</small>
                    </div>
                 </div>
                 <div class="grid-item">
                     <div class="input-group">
                        <label for="interval">Interval:</label>
                        <select id="interval" name="interval" required>
                             <option value="5m" {% if form_values.interval == '5m' %}selected{% endif %}>5 Minute</option>
                             <option value="15m" {% if form_values.interval == '15m' %}selected{% endif %}>15 Minute</option>
                             <option value="30m" {% if form_values.interval == '30m' %}selected{% endif %}>30 Minute</option>
                             <option value="1h" {% if form_values.interval == '1h' %}selected{% endif %}>Hourly</option>
                             <option value="1d" {% if form_values.interval == '1d' %}selected{% endif %}>Daily</option>
                             <option value="5d" {% if form_values.interval == '5d' %}selected{% endif %}>5 Days</option>
                             <option value="1wk" {% if not form_values.interval or form_values.interval == '1wk' %}selected{% endif %}>Weekly</option>
                             <option value="1mo" {% if form_values.interval == '1mo' %}selected{% endif %}>Monthly</option>
                             <option value="3mo" {% if form_values.interval == '3mo' %}selected{% endif %}>3 Months</option>
                        </select>
                    </div>
                 </div>

                <div class="section-subheading">Backtest Simulation (Optional)</div>

                <div class="grid-item grid-item-full backtest-toggle-item"> <label class="form-toggle">
                         <label class="toggle-label" for="run_backtest">Enable Backtest Mode</label>
                         <span class="toggle-switch">
                             <input class="form-check-input" type="checkbox" value="true" id="run_backtest" name="run_backtest" {{ 'checked' if form_values.run_backtest == 'true' }}>
                             <span class="toggle-slider"></span>
                         </span>
                     </label>
                 </div>

                <div class="grid-item">
                    <div class="input-group">
                        <label for="analysis_date">Analysis Date (Past End):</label>
                        <input type="date" class="form-control" id="analysis_date" name="analysis_date" value="{{ form_values.analysis_date or default_analysis_date }}">
                        <small>Run analysis *as if* this was the end date.</small>
                    </div>
                 </div>
                 <div class="grid-item">
                    <div class="input-group">
                        <label for="check_date">Check Date (Future End):</label>
                        <input type="date" class="form-control" id="check_date" name="check_date" value="{{ form_values.check_date or default_check_date }}">
                        <small>Show actual data up to this date.</small>
                    </div>
                 </div>
                  <p class="backtest-info">If 'Enable Backtest Mode' is checked, 'Analysis Date' and 'Check Date' are used. Otherwise, the standard 'End Date' field is used.</p>


                 <div class="section-subheading">Risk & Position Size (Optional)</div>

                <div class="grid-item">
                   <div class="input-group">
                       <label for="risk_percent">Risk per Trade (%):</label>
                       <input type="number" id="risk_percent" name="risk_percent" value="{{ form_values.risk_percent | default('1.0', true) }}" step="0.1" min="0.1" max="100" required>
                       <small>e.g., 1.0 = risk 1%</small>
                   </div>
                </div>
                <div class="grid-item">
                   <div class="input-group">
                       <label for="demo_account_size">Demo Account Size:</label>
                       <input type="number" id="demo_account_size" name="demo_account_size" value="{{ form_values.demo_account_size | default('10000', true) }}" step="100" min="100" required>
                       <small>e.g., 10000</small>
                   </div>
                </div>
                <div class="grid-item"></div>


            </div> <div class="submit-section">
                 <label class="form-toggle plot-toggle-item">
                    <label class="toggle-label" for="show_trade_on_plot">Show Trade Levels on Plot</label>
                     <span class="toggle-switch">
                         <input class="form-check-input" type="checkbox" value="true" id="show_trade_on_plot" name="show_trade_on_plot" {{ 'checked' if form_values.show_trade_on_plot == 'true' }}>
                        <span class="toggle-slider"></span>
                     </span>
                 </label>
                <input type="submit" value="Run Analysis / Backtest">
            </div>
        </form>

        {% if error %} <p class="error">{{ error }}</p> {% endif %}
        {% if multi_stock_results %} {% endif %}
        {% if plot_html %} {% elif request.method == 'POST' and not error and not multi_stock_results %} <p style="text-align:center; color: #999; margin: 40px 0;">No plot generated...</p> {% endif %}
        {% if trade_recommendation_data %} {% elif request.method == 'POST' and not error and not multi_stock_results %}{% if analysis_summary_data and not analysis_summary_data.get('error') %} {% endif %}{% endif %}
        {% if analysis_summary_data and not analysis_summary_data.get('error') %} {% elif request.method == 'POST' and not error and not multi_stock_results %}<p style="text-align:center; color: #999; margin: 40px 0;">Analysis request processed, but no summary data available...</p>{% endif %}
        <div class="disclaimer"><strong>*** DEMO / EDUCATIONAL USE ONLY - EXTREME WARNING ***</strong><br>This tool attempts conceptual Elliott Wave analysis... Always conduct your own thorough research...</div>
        <footer><p>Made by <a href="https://github.com/ESJavadex" target="_blank" rel="noopener noreferrer">Esjavadex</a></p></footer>
        </div> <script>
        document.addEventListener('DOMContentLoaded', function() {
            const hideNoEntryCheckbox = document.getElementById('hide-no-entry');
            const stockTableBody = document.querySelector('.stock-results-table tbody');
            const stockRows = stockTableBody ? Array.from(stockTableBody.querySelectorAll('tr[data-has-entry]')) : [];
            const sortableHeaders = document.querySelectorAll('th.sortable');
            const presetButtons = document.querySelectorAll('.preset-btn');
            const stockListInput = document.getElementById('stock_list');
            const analysisModeSelect = document.getElementById('analysis_mode');
            const toggleTableBtn = document.getElementById('toggle-table-btn');
            const multiStockResultsDiv = document.querySelector('.multi-stock-results');
            const visibleCountSpan = document.getElementById('visible-stocks-count');
            const singleTickerGroup = document.getElementById('single-ticker-group');
            const multiStockInputsGroup = document.getElementById('multi-stock-inputs');
            const singleTickerInput = document.getElementById('ticker');

            let currentSortColumn = 'ticker';
            let currentSortDirection = 'asc';
            let tableCollapsed = false;

            toggleAnalysisModeInputs(); // Set initial form state
            if (analysisModeSelect) {
                 analysisModeSelect.addEventListener('change', toggleAnalysisModeInputs);
            }

            // Initialize table features if table exists
            if (stockTableBody && stockRows.length > 0) {
                applyFilter();
                updateSortClasses(currentSortColumn, currentSortDirection);
                sortTable(currentSortColumn, currentSortDirection);
                updateVisibleCount();

                 if (hideNoEntryCheckbox) { hideNoEntryCheckbox.addEventListener('change', () => { applyFilter(); updateVisibleCount(); }); }
                 if (toggleTableBtn && multiStockResultsDiv) {
                     tableCollapsed = multiStockResultsDiv.classList.contains('collapsed');
                     updateToggleButton(tableCollapsed);
                     toggleTableBtn.addEventListener('click', () => { tableCollapsed = !tableCollapsed; multiStockResultsDiv.classList.toggle('collapsed', tableCollapsed); updateToggleButton(tableCollapsed); });
                 }
                 sortableHeaders.forEach(header => { header.addEventListener('click', () => { const column = header.getAttribute('data-sort'); if (column === currentSortColumn) { currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc'; } else { currentSortColumn = column; currentSortDirection = 'asc'; } updateSortClasses(currentSortColumn, currentSortDirection); sortTable(currentSortColumn, currentSortDirection); }); });
            } else if (multiStockResultsDiv) {
                 if(visibleCountSpan) visibleCountSpan.textContent = "No stocks to display.";
            }

            // Preset button listeners
            presetButtons.forEach(button => { button.addEventListener('click', () => { const stocks = button.getAttribute('data-stocks'); if (stockListInput && stocks !== null) { stockListInput.value = stocks.trim().replace(/\s+/g, ''); stockListInput.focus(); stockListInput.blur(); } if (analysisModeSelect && stocks !== "" && stocks !== null) { analysisModeSelect.value = 'multi'; analysisModeSelect.dispatchEvent(new Event('change')); } }); });

            // --- Functions ---
            function toggleAnalysisModeInputs() {
                 if (!analysisModeSelect || !singleTickerGroup || !multiStockInputsGroup) return;
                 const selectedMode = analysisModeSelect.value;
                 const showMulti = selectedMode === 'multi';

                 singleTickerGroup.style.display = showMulti ? 'none' : 'flex'; // Use flex for grid item
                 multiStockInputsGroup.style.display = showMulti ? 'flex' : 'none'; // Use flex

                 // Toggle required attribute
                 if(singleTickerInput) { singleTickerInput.required = !showMulti; }
                 if(stockListInput) { stockListInput.required = showMulti; }

                 // Adjust grid layout visibility (might need parent element if ticker/list groups affect layout)
                 // In this simple case, display:none should work okay with grid.
             }

            function updateToggleButton(isCollapsed) { /* ... as before ... */ if (!toggleTableBtn) return; toggleTableBtn.classList.toggle('collapsed', isCollapsed); toggleTableBtn.querySelector('.btn-text').textContent = isCollapsed ? 'Show Table' : 'Hide Table'; const icon = toggleTableBtn.querySelector('.icon'); if (icon) icon.textContent = isCollapsed ? '►' : '▼'; }
            function updateSortClasses(column, direction) { /* ... as before ... */ sortableHeaders.forEach(h => { h.classList.remove('sort-asc', 'sort-desc'); if (h.getAttribute('data-sort') === column) { h.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc'); } }); }
            function applyFilter() { /* ... as before ... */ if (!hideNoEntryCheckbox) return; const hideNoEntry = hideNoEntryCheckbox.checked; stockRows.forEach(row => { const hasEntry = row.getAttribute('data-has-entry') === 'true'; row.classList.toggle('hidden', !hasEntry && hideNoEntry); }); }
            function sortTable(column, direction) { /* ... as before ... */ if (!stockTableBody) return; const numericColumns = ['entry', 'sl', 'tp1', 'rrr', 'score', 'confidence']; const isNumeric = numericColumns.includes(column); stockRows.sort((a, b) => { let aValue = a.getAttribute(`data-${column}`) || ''; let bValue = b.getAttribute(`data-${column}`) || ''; let aIsNA = aValue === '' || aValue.toLowerCase() === 'n/a'; let bIsNA = bValue === '' || bValue.toLowerCase() === 'n/a'; if (isNumeric) { const valA = !aIsNA ? parseFloat(aValue) : (direction === 'asc' ? Infinity : -Infinity); const valB = !bIsNA ? parseFloat(bValue) : (direction === 'asc' ? Infinity : -Infinity); if (isNaN(valA) && isNaN(valB)) return 0; if (isNaN(valA)) return 1; if (isNaN(valB)) return -1; aValue = valA; bValue = valB; } else { aValue = aValue.toLowerCase(); bValue = bValue.toLowerCase(); aIsNA = aValue === '' || aValue === 'n/a'; bIsNA = bValue === '' || bValue === 'n/a'; if (aIsNA && bIsNA) return 0; if (aIsNA) return 1; if (bIsNA) return -1; } if (aValue < bValue) return direction === 'asc' ? -1 : 1; if (aValue > bValue) return direction === 'asc' ? 1 : -1; return 0; }); stockRows.forEach(row => stockTableBody.appendChild(row)); }
            function updateVisibleCount() { /* ... as before ... */ if (!visibleCountSpan) return; const visibleRows = stockRows.filter(row => !row.classList.contains('hidden')); const totalRows = stockRows.length; if (totalRows === 0) { visibleCountSpan.textContent = "No stocks analysed."; } else { visibleCountSpan.textContent = `Showing ${visibleRows.length} of ${totalRows} stocks`; } }
        });
    </script>

</body>
</html>